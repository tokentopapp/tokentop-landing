---
import { Image } from 'astro:assets';
import iconPng from '../assets/icon.png';

const links = [
  { href: "#features", label: "Features" },
  { href: "#providers", label: "Providers" },
  { href: "#demo", label: "Demo" },
  { href: "https://github.com/tokentopapp/tokentop", label: "GitHub", external: true },
];
---

<nav class="fixed top-0 left-0 right-0 z-50 border-b border-[var(--color-border)]/50 bg-[var(--color-bg-header)]/80 backdrop-blur-md transition-all duration-300" id="navbar">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <div class="flex-shrink-0 flex items-center gap-3">
        <a href="/" class="flex items-center gap-2 group">
          <Image src={iconPng} alt="tokentop logo" class="h-8 w-8 transition-transform group-hover:scale-105" loading="eager" />
          <span class="font-bold text-xl tracking-tight text-[var(--color-text-primary)]">tokentop</span>
        </a>
        <span id="version-badge" class="hidden text-xs font-mono text-[var(--color-text-muted)]/50 border border-[var(--color-border)]/50 rounded px-1.5 py-0.5 select-none"></span>
      </div>

      <!-- Desktop Links -->
      <div class="hidden md:block">
        <div class="ml-10 flex items-baseline space-x-8">
          {links.map((link) => (
            link.external ? (
              <a
                href={link.href}
                target="_blank"
                rel="noopener noreferrer"
                class="text-sm font-medium text-[var(--color-text-muted)] hover:text-[var(--color-primary)] transition-colors duration-200"
              >
                <svg class="w-3.5 h-3.5 inline-block align-[-0.125em] mr-1" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>GitHub
              </a>
            ) : (
              <a
                href={link.href}
                class="text-sm font-medium text-[var(--color-text-muted)] hover:text-[var(--color-primary)] transition-colors duration-200"
              >
                {link.label}
              </a>
            )
          ))}
        </div>
      </div>

      <!-- Mobile Menu Button -->
      <div class="-mr-2 flex md:hidden">
        <button
          type="button"
          class="inline-flex items-center justify-center p-2 rounded-md text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-bg-card)] focus:outline-none"
          aria-controls="mobile-menu"
          aria-expanded="false"
          id="mobile-menu-btn"
        >
          <span class="sr-only">Open main menu</span>
          <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="md:hidden hidden bg-[var(--color-bg-header)] border-b border-[var(--color-border)]" id="mobile-menu">
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      {links.map((link) => (
        <a
          href={link.href}
          target={link.external ? "_blank" : undefined}
          class="block px-3 py-2 rounded-md text-base font-medium text-[var(--color-text-primary)] hover:text-[var(--color-primary)] hover:bg-[var(--color-bg-card)]"
        >
          {link.label}
        </a>
      ))}
    </div>
  </div>
</nav>

<script>
  const btn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');

  if (btn && menu) {
    btn.addEventListener('click', () => {
      menu.classList.toggle('hidden');
    });
  }

  // Fetch latest release version from GitHub
  const badge = document.getElementById('version-badge');
  if (badge) {
    fetch('https://api.github.com/repos/tokentopapp/tokentop/releases/latest')
      .then(r => r.ok ? r.json() : null)
      .then(data => {
        if (data?.tag_name) {
          badge.textContent = data.tag_name;
          badge.classList.remove('hidden');
        }
      })
      .catch(() => {});
  }
</script>
